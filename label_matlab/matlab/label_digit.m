clear all;
close all;

floor_area = [213 12 14 13];

flist  = {
    [0:35],...
    [36:408],...
    [409:450],...
    [451:480],...
    [481:510],...
    [511:540],...
    [541:570],...
    [571:600],...
    [601:630],...
    [631:660],...
    [661:690],...
    [691:720],...
    [721:750],...
    [751:780],...
    [781:810],...
    [811:840],...
    [841:870],...
    [871:900],...
    [901:930],...
    [931:960],...
    [961:990],...
    [991:1020],...
    [1021:1050],...
    [1051:1080],...
    [1081:1118],... 
    [1167:1274]};


% floor number
fid_train_data = fopen('floor_train_data.bin','w');
fid_train_label = fopen('floor_train_label.bin','w');
fid_test_data = fopen('floor_test_data.bin','w');
fid_test_label = fopen('floor_test_label.bin','w');

rng(1234);
testdata = 0;
traindata = 0;
for ii = 1 : size(flist,2)  
    for jj = 1 : min(size(flist{ii},2),30)
        fn = strcat('D:\workspace\vision\elevator_monitor\jpg\',int2str(flist{ii}(jj)),'.jpg');
        I = im2single(imread(fn));
        I2 = imcrop(I,floor_area);
        I2 = imresize(I2, [28 28]);
        I2_gray = rgb2gray(I2);
        for kk = 0 : 39
%             fn = strcat('D:\workspace\vision\elevator_monitor\jpg\digit\gray\',int2str(ii-1),'_',int2str((jj-1)*10+kk),'.jpg');
%             if(kk == 0) 
% %                 imwrite(im2uint8(I2_gray),fn);  
%                 fwrite(fid_train_data,im2uint8(I2_gray)','uint8');
%                 fwrite(fid_train_label,ii-1,'uint8');
%                 traindata = traindata + 1;                            
            if(kk >= 30 && kk <= 39)
%                 imwrite(im2uint8(I2_gray),fn);  
                fwrite(fid_test_data,im2uint8(I2_gray)','uint8');
                fwrite(fid_test_label,ii-1,'uint8');
                testdata = testdata + 1;
            else 
                sat_scale = abs(0.5 + 0.1*randn(1));
                sat_center = 0.15*randn(1);
                I2_gray_sat = (tanh(-1+(I2_gray+sat_center)/sat_scale) + 1)/2;
                I2_gray_sat = im2uint8(I2_gray_sat);
%                 imwrite(I2_gray_sat,fn);      
                fwrite(fid_train_data,I2_gray_sat','uint8');
                fwrite(fid_train_label,ii-1,'uint8');     
                traindata = traindata + 1;
            end
        
        end
    end
end


flist_extra  = {
    [0:35],...
    [36:408],...
    [409:450],...
    [451:480],...
    [481:510],...
    [511:540],...
    [541:570],...
    [571:600],...
    [601:630],...
    [631:660],...
    [661:690],...
    [691:720],...
    [721:750],...
    [751:780,4907:5173],... 
    [781:810,1894:3415,4876:4898,5174:5545],...
    [811:840,1856:1893,3416:3450],...
    [841:870,1826:1855,3451:3480,4816:4825],...
    [871:900,1796:1825,3481:3510,4786:4795],...
    [901:930,1766:1795,3511:3540,4756:4765],...
    [931:960,1736:1765,3541:3570,4726:4735],...
    [961:990,1706:1735,3571:3600,4694:4703],...
    [991:1020,1676:1705,3601:3630,4664:4673],...
    [1021:1050,1646:1675,3631:3660,4535:4544],...
    [1051:1080,1616:1645,3661:3690,4275:4284],...
    [1081:1118,1581:1615,3691:3728,4179:4220],...
    [1167:1266,3736:3741,3747:3753,3760:3766,3731:3779,3784:3884,4037:4178]};


for ii = 1 : size(flist_extra,2)  
    for jj = 1 : size(flist_extra{ii},2)
        fn = strcat('D:\workspace\vision\elevator_monitor\jpg\',int2str(flist_extra{ii}(jj)),'.jpg');
        I = im2single(imread(fn));
        I2 = imcrop(I,floor_area);
        I2 = imresize(I2, [28 28]);
        I2_gray = rgb2gray(I2);
 
        fwrite(fid_train_data,im2uint8(I2_gray)','uint8');
        fwrite(fid_train_label,ii-1,'uint8');
        traindata = traindata + 1;                            
    end
end



testdata
traindata
fclose(fid_train_data);
fclose(fid_train_label);
fclose(fid_test_data);
fclose(fid_test_label);


